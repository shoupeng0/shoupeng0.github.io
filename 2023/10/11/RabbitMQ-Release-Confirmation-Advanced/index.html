<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="ä»¥æ¢¦ä¸ºé©¬" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="ä»¥æ¢¦ä¸ºé©¬" type="application/atom+xml"><link rel="alternate" type="application/json" title="ä»¥æ¢¦ä¸ºé©¬" href="https://shoupeng0.github.io/feed.json"/><link rel="preconnect" href="https://lf9-cdn-tos.bytecdntp.com"/><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"/><link rel="dns-prefetch" href="https://unpkg.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.3.6"><script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.js"></script><link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css"/><meta name="keywords" content="MQ,"/><link rel="canonical" href="https://shoupeng0.github.io/2023/10/11/RabbitMQ-Release-Confirmation-Advanced/"><title>RabbitMQ å‘å¸ƒç¡®è®¤é«˜çº§</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">RabbitMQ å‘å¸ƒç¡®è®¤é«˜çº§</h1><div class="meta"><span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2023-10-11 10:46:29"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">å‘è¡¨äº</span><time itemprop="dateCreated datePublished" datetime="2023-10-11T10:46:29+08:00">2023-10-11</time></span><span class="item" title="æœ¬æ–‡å­—æ•°"><span class="icon"><i class="ic i-pen"></i></span><span class="text">æœ¬æ–‡å­—æ•°</span><span>11k</span><span class="text">å­—</span></span><span class="item" title="é˜…è¯»æ—¶é•¿"><span class="icon"><i class="ic i-clock"></i></span><span class="text">é˜…è¯»æ—¶é•¿</span><span>10 åˆ†é’Ÿ</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Mr. Shou's blog</a></li></ul><ul class="right" id="rightNav"><li class="item theme" @click="changeThemeByBtn"><i class="ic" :class="{'i-sun': !themeStatus,'i-moon': themeStatus}"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" data-background-image="https://i.imgtg.com/2023/03/09/Y0kTl.jpg"></li><li class="item" data-background-image="https://i.imgtg.com/2023/03/09/Y0xvg.jpg"></li><li class="item" data-background-image="https://i.imgtg.com/2023/03/09/Y0hOs.jpg"></li><li class="item" data-background-image="https://i.imgtg.com/2023/03/09/YSj7p.jpg"></li><li class="item" data-background-image="https://i.imgtg.com/2023/03/09/YS6XY.jpg"></li><li class="item" data-background-image="https://i.imgtg.com/2023/03/09/Y0iNK.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/MQ/" itemprop="item" rel="index" title="åˆ†ç±»äºMQ"><span itemprop="name">MQ<meta itemprop="position" content="0"/></span></a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/MQ/RabbitMQ/" itemprop="item" rel="index" title="åˆ†ç±»äºRabbitMQ"><span itemprop="name">RabbitMQ<meta itemprop="position" content="1"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://shoupeng0.github.io/2023/10/11/RabbitMQ-Release-Confirmation-Advanced/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="é¦–å…ˆæ£®"/><meta itemprop="description" content="ä¸è´ŸéŸ¶å, é¦–å…ˆæ£®çš„ä¸ªäººåšå®¢"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="ä»¥æ¢¦ä¸ºé©¬"/></span><div class="body md" itemprop="articleBody"><h1 id="rabbitmq-å‘å¸ƒç¡®è®¤é«˜çº§"><a class="anchor" href="#rabbitmq-å‘å¸ƒç¡®è®¤é«˜çº§">#</a> RabbitMQ å‘å¸ƒç¡®è®¤é«˜çº§</h1>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”±äºä¸€äº›ä¸æ˜åŸå› ï¼Œå¯¼è‡´ RabbitMQ é‡å¯ï¼Œåœ¨ RabbitMQ é‡å¯æœŸé—´ç”Ÿäº§è€…æ¶ˆæ¯æŠ•é€’å¤±è´¥ï¼Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†å’Œæ¢å¤ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¼€å§‹æ€è€ƒï¼Œå¦‚ä½•æ‰èƒ½è¿›è¡Œ RabbitMQ çš„æ¶ˆæ¯å¯é æŠ•é€’å‘¢ï¼Ÿ</p>
<h2 id="å‘å¸ƒç¡®è®¤springbootç‰ˆæœ¬"><a class="anchor" href="#å‘å¸ƒç¡®è®¤springbootç‰ˆæœ¬">#</a> å‘å¸ƒç¡®è®¤ SpringBoot ç‰ˆæœ¬</h2>
<p>ç®€å•çš„å‘å¸ƒç¡®è®¤æœºåˆ¶åœ¨<span class="exturl" data-url="aHR0cHM6Ly9mcnhjYXQuZnVuL21pZGRsZXdhcmUvUmFiYml0TVEvUmFiYml0TVFfTWVzc2FnZV9yZXNwb25zZUFuZHJlbGVhc2Uv">åº”ç­”ä¸ç­¾æ”¶</span>å·²ç»ä»‹ç»ï¼Œæœ¬å†…å®¹å°†ä»‹ç»æ•´åˆäº† SpringBoot çš„å‘å¸ƒç¡®è®¤æœºåˆ¶ã€‚</p>
<h3 id="ä»‹ç»"><a class="anchor" href="#ä»‹ç»">#</a> ä»‹ç»</h3>
<p>é¦–å…ˆå‘å¸ƒæ¶ˆæ¯åè¿›è¡Œå¤‡ä»½åœ¨ç¼“å­˜é‡Œï¼Œå¦‚æœæ¶ˆæ¯æˆåŠŸå‘å¸ƒç¡®è®¤åˆ°äº¤æ¢æœºï¼Œåˆ™ä»ç¼“å­˜é‡Œåˆ é™¤è¯¥æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰æˆåŠŸå‘å¸ƒï¼Œåˆ™è®¾ç½®ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œé‡æ–°ä»ç¼“å­˜é‡Œè·å–æ¶ˆæ¯å‘å¸ƒåˆ°äº¤æ¢æœºï¼Œç›´åˆ°æˆåŠŸå‘å¸ƒåˆ°äº¤æ¢æœºã€‚</p>
<p>ç¡®è®¤æœºåˆ¶å›¾ä¾‹ï¼š</p>
<p><img data-src="https://jsd.cdn.zzko.cn/gh/xustudyxu/image-hosting1@master/20220726/image.7c8btl8ibwo0.webp" alt="image" /></p>
<h3 id="å®æˆ˜"><a class="anchor" href="#å®æˆ˜">#</a> å®æˆ˜</h3>
<p>ä¸€ä¸ªäº¤æ¢æœºï¼šconfirm.exchangeï¼Œä¸€ä¸ªé˜Ÿåˆ—ï¼šconfirm.queueï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ï¼šconfirm.consumer</p>
<p>å…¶ä¸­äº¤æ¢æœºç±»å‹æ—¶ directï¼Œä¸é˜Ÿåˆ—å…³è”çš„ routingKey æ˜¯ key1</p>
<p>ä»£ç æ¶æ„å›¾ï¼š</p>
<p><img data-src="https://jsd.cdn.zzko.cn/gh/xustudyxu/image-hosting1@master/20220726/image.7ddz8ceuxk40.webp" alt="image" /></p>
<p>åœ¨é…ç½®æ–‡ä»¶å½“ä¸­éœ€è¦æ·»åŠ </p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8888</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.91.200</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">username</span><span class="token punctuation">:</span> root</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">publisher-confirm-type</span><span class="token punctuation">:</span> correlated</pre></td></tr></table></figure><ul>
<li><code>NONE</code>  å€¼æ˜¯ç¦ç”¨å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œæ˜¯é»˜è®¤å€¼ï¼Œ<strong>ä¸è¿›è¡Œç¡®è®¤</strong></li>
<li><code>CORRELATED</code>  å€¼æ˜¯å‘å¸ƒæ¶ˆæ¯æˆåŠŸåˆ°äº¤æ¢å™¨åä¼šè§¦å‘å›è°ƒæ–¹æ³•ï¼Œ<strong>å¼‚æ­¥ç¡®è®¤</strong></li>
<li><code>SIMPLE</code>  å€¼ç»æµ‹è¯•æœ‰ä¸¤ç§æ•ˆæœï¼Œå…¶ä¸€æ•ˆæœå’Œ CORRELATED å€¼ä¸€æ ·ä¼šè§¦å‘å›è°ƒæ–¹æ³•ï¼Œå…¶äºŒåœ¨å‘å¸ƒæ¶ˆæ¯æˆåŠŸåä½¿ç”¨ rabbitTemplate è°ƒç”¨ waitForConfirms æˆ– waitForConfirmsOrDie æ–¹æ³•ç­‰å¾… broker èŠ‚ç‚¹è¿”å›å‘é€ç»“æœï¼Œæ ¹æ®è¿”å›ç»“æœæ¥åˆ¤å®šä¸‹ä¸€æ­¥çš„é€»è¾‘ï¼Œè¦æ³¨æ„çš„ç‚¹æ˜¯ waitForConfirmsOrDie æ–¹æ³•å¦‚æœè¿”å› false åˆ™ä¼šå…³é—­ channelï¼Œåˆ™æ¥ä¸‹æ¥æ— æ³•å‘é€æ¶ˆæ¯åˆ° brokerï¼Œ<strong>åŒæ­¥ç¡®è®¤</strong></li>
</ul>
<h3 id="æ·»åŠ é…ç½®ç±»"><a class="anchor" href="#æ·»åŠ é…ç½®ç±»">#</a> æ·»åŠ é…ç½®ç±»</h3>
<p>å£°æ˜äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼Œå¹¶ä¸”å°†äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®š</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</pre></td></tr><tr><td data-num="2"></td><td><pre> * descï¼šé…ç½®ç±»ï¼Œå‘å¸ƒç¡®è®¤ (é«˜çº§)</pre></td></tr><tr><td data-num="3"></td><td><pre> */</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfirmConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// äº¤æ¢æœº</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">"confirm_exchange"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">"confirm_queue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">//routingKey</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_ROUTING_KEY</span> <span class="token operator">=</span> <span class="token string">"key1"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// å£°æ˜äº¤æ¢æœº</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"confirmExchange"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">confirmExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_EXCHANGE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// å£°æ˜é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"confirmQueue"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">confirmQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_QUEUE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">// ç»‘å®š</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">queueBindingExchange</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"confirmQueue"</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> confirmQueue<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                                        <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"confirmExchange"</span><span class="token punctuation">)</span> <span class="token class-name">DirectExchange</span> confirmExchange<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>confirmQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>confirmExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_ROUTING_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯ç”Ÿäº§è€…"><a class="anchor" href="#æ¶ˆæ¯ç”Ÿäº§è€…">#</a> <strong>æ¶ˆæ¯ç”Ÿäº§è€…</strong></h3>
<p>ä¹Ÿå¯ä»¥è¯´æ˜¯ Controller å±‚</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</pre></td></tr><tr><td data-num="2"></td><td><pre> * desc: é«˜çº§æ¶ˆæ¯å‘å¸ƒ æ¶ˆæ¯ç”Ÿäº§è€…</pre></td></tr><tr><td data-num="3"></td><td><pre> */</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@Slf4j</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/confirm"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token annotation punctuation">@RestController</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductController</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// å¼€å§‹å‘æ¶ˆæ¯ï¼Œæµ‹è¯•ç¡®è®¤</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/sendMessage/&#123;message&#125;"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment">// æŒ‡å®šæ¶ˆæ¯ id ä¸º 1</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token class-name">CorrelationData</span> correlationData1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token class-name">ConfirmConfig</span><span class="token punctuation">.</span><span class="token constant">CONFIRM_EXCHANGE_NAME</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token class-name">ConfirmConfig</span><span class="token punctuation">.</span><span class="token constant">CONFIRM_ROUTING_KEY</span><span class="token punctuation">,</span>message<span class="token operator">+</span><span class="token string">"key1"</span><span class="token punctuation">,</span>correlationData1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‘é€æ¶ˆæ¯å†…å®¹:&#123;&#125;"</span><span class="token punctuation">,</span>message<span class="token operator">+</span><span class="token string">"key1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">// æŒ‡å®šæ¶ˆæ¯ id ä¸º 2</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token class-name">CorrelationData</span> correlationData2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token class-name">String</span> <span class="token constant">CONFIRM_ROUTING_KEY</span> <span class="token operator">=</span> <span class="token string">"key2"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token class-name">ConfirmConfig</span><span class="token punctuation">.</span><span class="token constant">CONFIRM_EXCHANGE_NAME</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token constant">CONFIRM_ROUTING_KEY</span><span class="token punctuation">,</span>message<span class="token operator">+</span><span class="token string">"key2"</span><span class="token punctuation">,</span>correlationData2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å‘é€æ¶ˆæ¯å†…å®¹:&#123;&#125;"</span><span class="token punctuation">,</span>message<span class="token operator">+</span><span class="token string">"key2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯æ¶ˆè´¹è€…"><a class="anchor" href="#æ¶ˆæ¯æ¶ˆè´¹è€…">#</a> <strong>æ¶ˆæ¯æ¶ˆè´¹è€…</strong></h3>
<p>ç›‘å¬  <code>confirm.queue</code>  é˜Ÿåˆ—</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</pre></td></tr><tr><td data-num="2"></td><td><pre> * desc: æ¥å—æ¶ˆæ¯</pre></td></tr><tr><td data-num="3"></td><td><pre> */</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@Slf4j</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token class-name">ConfirmConfig</span><span class="token punctuation">.</span><span class="token constant">CONFIRM_QUEUE_NAME</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveConfirmMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ¥å—åˆ°çš„é˜Ÿåˆ—confirm.queueæ¶ˆæ¯:&#123;&#125;"</span><span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åçš„å›è°ƒæ¥å£"><a class="anchor" href="#æ¶ˆæ¯ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åçš„å›è°ƒæ¥å£">#</a> <strong>æ¶ˆæ¯ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åçš„å›è°ƒæ¥å£</strong></h3>
<p>åªè¦ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯ï¼Œäº¤æ¢æœºä¸ç®¡æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯ï¼Œéƒ½ä¼šè°ƒç”¨è¯¥ç±»çš„  <code>confirm</code>  æ–¹æ³•</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</pre></td></tr><tr><td data-num="2"></td><td><pre> * desc: å›è°ƒæ¥å£</pre></td></tr><tr><td data-num="3"></td><td><pre> */</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@Slf4j</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCallBack</span> <span class="token keyword">implements</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// æ³¨å…¥</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token annotation punctuation">@PostConstruct</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">// æ³¨å…¥</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">/**</pre></td></tr><tr><td data-num="16"></td><td><pre>     * äº¤æ¢æœºä¸ç®¡æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯çš„ä¸€ä¸ªå›è°ƒæ–¹æ³•</pre></td></tr><tr><td data-num="17"></td><td><pre>     * 1. å‘æ¶ˆæ¯ äº¤æ¢æœºæ¥æ”¶åˆ°äº† å›è°ƒ</pre></td></tr><tr><td data-num="18"></td><td><pre>     * @param correlationData  ä¿å­˜å›è°ƒä¿¡æ¯çš„ Id åŠç›¸å…³ä¿¡æ¯</pre></td></tr><tr><td data-num="19"></td><td><pre>     * @param ack              äº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ ä¸º true</pre></td></tr><tr><td data-num="20"></td><td><pre>     * @param cause            æœªæ”¶åˆ°æ¶ˆæ¯çš„åŸå› </pre></td></tr><tr><td data-num="21"></td><td><pre>     *</pre></td></tr><tr><td data-num="22"></td><td><pre>     */</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span><span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token class-name">String</span> id <span class="token operator">=</span> correlationData<span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">?</span>correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"äº¤æ¢æœºå·²ç»æ”¶åˆ°äº†IDä¸º:&#123;&#125;çš„æ¶ˆæ¯"</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"äº¤æ¢æœºè¿˜æœªæ”¶åˆ°IDä¸º:&#123;&#125;çš„æ¶ˆæ¯ï¼Œç”±äºåŸå› :&#123;&#125;"</span><span class="token punctuation">,</span>id<span class="token punctuation">,</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4ODg4L2NvbmZpcm0vc2VuZE1lc3NhZ2UvJUU1JUE0JUE3JUU1JUFFJUI2JUU1JUE1JUJEMQ==">http://localhost:8888/confirm/sendMessage/ å¤§å®¶å¥½ 1 (opens new window)</span></p>
<p>ç»“æœåˆ†æ:</p>
<p><img data-src="https://jsd.cdn.zzko.cn/gh/xustudyxu/image-hosting1@master/20220726/image.5cpvzjf8zb40.webp" alt="image" /></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå‘é€äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œç¬¬ä¸€æ¡æ¶ˆæ¯çš„ RoutingKey ä¸º &quot;key1&quot;ï¼Œç¬¬äºŒæ¡æ¶ˆæ¯çš„ RoutingKey ä¸º &quot;key2&quot;ï¼Œä¸¤æ¡æ¶ˆæ¯éƒ½æˆåŠŸè¢«äº¤æ¢æœºæ¥æ”¶ï¼Œä¹Ÿæ”¶åˆ°äº†äº¤æ¢æœºçš„ç¡®è®¤å›è°ƒï¼Œä½†æ¶ˆè´¹è€…åªæ”¶åˆ°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå› ä¸ºç¬¬äºŒæ¡æ¶ˆæ¯çš„ RoutingKey ä¸é˜Ÿåˆ—çš„ BindingKey ä¸ä¸€è‡´ï¼Œä¹Ÿæ²¡æœ‰å…¶å®ƒé˜Ÿåˆ—èƒ½æ¥æ”¶è¿™ä¸ªæ¶ˆæ¯ï¼Œæ‰€æœ‰ç¬¬äºŒæ¡æ¶ˆæ¯è¢«ç›´æ¥ä¸¢å¼ƒäº†ã€‚</p>
<p>ä¸¢å¼ƒçš„æ¶ˆæ¯äº¤æ¢æœºæ˜¯ä¸çŸ¥é“çš„ï¼Œéœ€è¦è§£å†³å‘Šè¯‰ç”Ÿäº§è€…æ¶ˆæ¯ä¼ é€å¤±è´¥ã€‚</p>
<h2 id="å›é€€æ¶ˆæ¯"><a class="anchor" href="#å›é€€æ¶ˆæ¯">#</a> å›é€€æ¶ˆæ¯</h2>
<h3 id="ä»‹ç»-2"><a class="anchor" href="#ä»‹ç»-2">#</a> ä»‹ç»</h3>
<p>è·å–å›é€€çš„æ¶ˆæ¯ï¼Œé¦–å…ˆåœ¨é…ç½®æ–‡ä»¶å¼€å¯è¯¥åŠŸèƒ½ï¼Œç„¶åéœ€è¦è‡ªå®šä¹‰ç±»å®ç°  <code>RabbitTemplate.ReturnsCallback</code>  æ¥å£ï¼Œå¹¶ä¸”åˆå§‹åŒ–æ—¶ï¼Œä½¿ç”¨è¯¥è‡ªå®šä¹‰ç±»ä½œä¸ºå›é€€æ¶ˆæ¯çš„å¤„ç†ç±»ï¼ŒåŒæ—¶å¼€å¯  <code>Mandatory</code> ï¼Œè®¾ç½®ä¸º true</p>
<p>åœ¨å¯åŠ¨å¼€å¯ Mandatoryï¼Œæˆ–è€…åœ¨ä»£ç é‡Œæ‰‹åŠ¨å¼€å¯ Mandatory å‚æ•°ï¼Œæˆ–è€…éƒ½å¼€å¯ğŸ˜¸</p>
<p>é…ç½®ç±»æ–‡ä»¶å¼€å¯ï¼š</p>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># æ–°ç‰ˆ</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  	<span class="token key atrule">template</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token key atrule">mandatory</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># æ—§ç‰ˆ</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">mandatory</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr></table></figure><p>ä»£ç ä¸­å¼€å¯:</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre>rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>åœ¨ä»…å¼€å¯äº†ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šç›´æ¥ç»™æ¶ˆæ¯ç”Ÿäº§è€…å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœå‘ç°è¯¥æ¶ˆæ¯ä¸å¯è·¯ç”±ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šè¢«ç›´æ¥ä¸¢å¼ƒï¼Œæ­¤æ—¶ç”Ÿäº§è€…æ˜¯ä¸çŸ¥é“æ¶ˆæ¯è¢«ä¸¢å¼ƒè¿™ä¸ªäº‹ä»¶çš„ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•è®©æ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯å¸®æˆ‘æƒ³åŠæ³•å¤„ç†ä¸€ä¸‹ï¼Ÿæœ€èµ·ç é€šçŸ¥æˆ‘ä¸€å£°ï¼Œæˆ‘å¥½è‡ªå·±å¤„ç†å•Šã€‚é€šè¿‡è®¾ç½® mandatory å‚æ•°å¯ä»¥åœ¨å½“æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ä¸å¯è¾¾ç›®çš„åœ°æ—¶å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚</p>
<h3 id="å®æˆ˜-2"><a class="anchor" href="#å®æˆ˜-2">#</a> å®æˆ˜</h3>
<h4 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a class="anchor" href="#ä¿®æ”¹é…ç½®æ–‡ä»¶">#</a> ä¿®æ”¹é…ç½®æ–‡ä»¶</h4>
<figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.91.200</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token key atrule">username</span><span class="token punctuation">:</span> root</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token key atrule">publisher-confirm-type</span><span class="token punctuation">:</span> correlated</pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token key atrule">publisher-returns</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token key atrule">template</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token key atrule">mandatory</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token key atrule">server</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8888</span></pre></td></tr></table></figure><h4 id="ä¿®æ”¹å›è°ƒæ¥å£"><a class="anchor" href="#ä¿®æ”¹å›è°ƒæ¥å£">#</a> ä¿®æ”¹å›è°ƒæ¥å£</h4>
<p>å®ç°  <code>RabbitTemplate.ReturnsCallback</code>  æ¥å£ï¼Œå¹¶å®ç°æ–¹æ³•</p>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</pre></td></tr><tr><td data-num="2"></td><td><pre> * desc: å›è°ƒæ¥å£</pre></td></tr><tr><td data-num="3"></td><td><pre> */</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@Slf4j</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCallBack</span> <span class="token keyword">implements</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">,</span><span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnsCallback</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// æ³¨å…¥</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token annotation punctuation">@Autowired</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token annotation punctuation">@PostConstruct</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">// æ³¨å…¥</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnsCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">/**</pre></td></tr><tr><td data-num="17"></td><td><pre>     * äº¤æ¢æœºä¸ç®¡æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯çš„ä¸€ä¸ªå›è°ƒæ–¹æ³•</pre></td></tr><tr><td data-num="18"></td><td><pre>     * 1. å‘æ¶ˆæ¯ äº¤æ¢æœºæ¥æ”¶åˆ°äº† å›è°ƒ</pre></td></tr><tr><td data-num="19"></td><td><pre>     * @param correlationData  ä¿å­˜å›è°ƒä¿¡æ¯çš„ Id åŠç›¸å…³ä¿¡æ¯</pre></td></tr><tr><td data-num="20"></td><td><pre>     * @param ack              äº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ ä¸º true</pre></td></tr><tr><td data-num="21"></td><td><pre>     * @param cause            æœªæ”¶åˆ°æ¶ˆæ¯çš„åŸå› </pre></td></tr><tr><td data-num="22"></td><td><pre>     *</pre></td></tr><tr><td data-num="23"></td><td><pre>     */</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span><span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token class-name">String</span> id <span class="token operator">=</span> correlationData<span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">?</span>correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"äº¤æ¢æœºå·²ç»æ”¶åˆ°äº†IDä¸º:&#123;&#125;çš„æ¶ˆæ¯"</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"äº¤æ¢æœºè¿˜æœªæ”¶åˆ°IDä¸º:&#123;&#125;çš„æ¶ˆæ¯ï¼Œç”±äºåŸå› :&#123;&#125;"</span><span class="token punctuation">,</span>id<span class="token punctuation">,</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token comment">// å¯ä»¥åœ¨å½“æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ä¸å¯è¾¾ç›®çš„åœ°æ—¶å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token comment">// åªæœ‰ä¸å¯è¾¾ç›®çš„åœ°çš„æ—¶å€™ æ‰è¿›è¡Œå›é€€</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment">/**</pre></td></tr><tr><td data-num="36"></td><td><pre>     * å½“æ¶ˆæ¯æ— æ³•è·¯ç”±çš„æ—¶å€™çš„å›è°ƒæ–¹æ³•</pre></td></tr><tr><td data-num="37"></td><td><pre>     *  message      æ¶ˆæ¯</pre></td></tr><tr><td data-num="38"></td><td><pre>     *  replyCode    ç¼–ç </pre></td></tr><tr><td data-num="39"></td><td><pre>     *  replyText    é€€å›åŸå› </pre></td></tr><tr><td data-num="40"></td><td><pre>     *  exchange     ä»å“ªä¸ªäº¤æ¢æœºé€€å›</pre></td></tr><tr><td data-num="41"></td><td><pre>     *  routingKey   é€šè¿‡å“ªä¸ªè·¯ç”± key é€€å›</pre></td></tr><tr><td data-num="42"></td><td><pre>     */</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">ReturnedMessage</span> returned<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆæ¯&#123;&#125;,è¢«äº¤æ¢æœº&#123;&#125;é€€å›ï¼Œé€€å›åŸå› :&#123;&#125;,è·¯ç”±key:&#123;&#125;"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>returned<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>returned<span class="token punctuation">.</span><span class="token function">getExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                returned<span class="token punctuation">.</span><span class="token function">getReplyText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>returned<span class="token punctuation">.</span><span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>æ‰“å¼€æµè§ˆå™¨è®¿é—®åœ°å€ï¼š<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4ODg4L2NvbmZpcm0vc2VuZE1lc3NhZ2UvJUU1JUE0JUE3JUU1JUFFJUI2JUU1JUE1JUJEMQ==">http://localhost:8888/confirm/sendMessage/ å¤§å®¶å¥½ 1 (opens new window)</span></p>
<p><img data-src="https://jsd.cdn.zzko.cn/gh/xustudyxu/image-hosting1@master/20220726/image.6ag1qfe3xws0.webp" alt="image" /></p>
<h2 id="å¤‡ä»½äº¤æ¢æœº"><a class="anchor" href="#å¤‡ä»½äº¤æ¢æœº">#</a> å¤‡ä»½äº¤æ¢æœº</h2>
<h3 id="ä»‹ç»-3"><a class="anchor" href="#ä»‹ç»-3">#</a> ä»‹ç»</h3>
<p>æœ‰äº† mandatory å‚æ•°å’Œå›é€€æ¶ˆæ¯ï¼Œæˆ‘ä»¬è·å¾—äº†å¯¹æ— æ³•æŠ•é€’æ¶ˆæ¯çš„æ„ŸçŸ¥èƒ½åŠ›ï¼Œæœ‰æœºä¼šåœ¨ç”Ÿäº§è€…çš„æ¶ˆæ¯æ— æ³•è¢«æŠ•é€’æ—¶å‘ç°å¹¶å¤„ç†ã€‚ä½†æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯ï¼Œæœ€å¤šæ‰“ä¸ªæ—¥å¿—ï¼Œç„¶åè§¦å‘æŠ¥è­¦ï¼Œå†æ¥æ‰‹åŠ¨å¤„ç†ã€‚è€Œé€šè¿‡æ—¥å¿—æ¥å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯æ˜¯å¾ˆä¸ä¼˜é›…çš„åšæ³•ï¼Œç‰¹åˆ«æ˜¯å½“ç”Ÿäº§è€…æ‰€åœ¨çš„æœåŠ¡æœ‰å¤šå°æœºå™¨çš„æ—¶å€™ï¼Œæ‰‹åŠ¨å¤åˆ¶æ—¥å¿—ä¼šæ›´åŠ éº»çƒ¦è€Œä¸”å®¹æ˜“å‡ºé”™ã€‚è€Œä¸”è®¾ç½® mandatory å‚æ•°ä¼šå¢åŠ ç”Ÿäº§è€…çš„å¤æ‚æ€§ï¼Œéœ€è¦æ·»åŠ å¤„ç†è¿™äº›è¢«é€€å›çš„æ¶ˆæ¯çš„é€»è¾‘ã€‚å¦‚æœæ—¢ä¸æƒ³ä¸¢å¤±æ¶ˆæ¯ï¼Œåˆä¸æƒ³å¢åŠ ç”Ÿäº§è€…çš„å¤æ‚æ€§ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>å‰é¢åœ¨è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°ï¼Œå¯ä»¥ä¸ºé˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœºæ¥å­˜å‚¨é‚£äº›å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¯æ˜¯è¿™äº›ä¸å¯è·¯ç”±æ¶ˆæ¯æ ¹æœ¬æ²¡æœ‰æœºä¼šè¿›å…¥åˆ°é˜Ÿåˆ—ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿å­˜æ¶ˆæ¯ã€‚ åœ¨ RabbitMQ ä¸­ï¼Œæœ‰ä¸€ç§å¤‡ä»½äº¤æ¢æœºçš„æœºåˆ¶å­˜åœ¨ï¼Œå¯ä»¥å¾ˆå¥½çš„åº”å¯¹è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ä»€ä¹ˆæ˜¯å¤‡ä»½äº¤æ¢æœºå‘¢ï¼Ÿå¤‡ä»½äº¤æ¢æœºå¯ä»¥ç†è§£ä¸º RabbitMQ ä¸­äº¤æ¢æœºçš„ â€œå¤‡èƒâ€ï¼Œå½“æˆ‘ä»¬ä¸ºæŸä¸€ä¸ªäº¤æ¢æœºå£°æ˜ä¸€ä¸ªå¯¹åº”çš„å¤‡ä»½äº¤æ¢æœºæ—¶ï¼Œå°±æ˜¯ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå¤‡èƒï¼Œå½“äº¤æ¢æœºæ¥æ”¶åˆ°ä¸€æ¡ä¸å¯è·¯ç”±æ¶ˆæ¯æ—¶ï¼Œå°†ä¼šæŠŠè¿™æ¡æ¶ˆæ¯è½¬å‘åˆ°å¤‡ä»½äº¤æ¢æœºä¸­ï¼Œç”±å¤‡ä»½äº¤æ¢æœºæ¥è¿›è¡Œè½¬å‘å’Œå¤„ç†ï¼Œé€šå¸¸å¤‡ä»½äº¤æ¢æœºçš„ç±»å‹ä¸º Fanout ï¼Œè¿™æ ·å°±èƒ½æŠŠæ‰€æœ‰æ¶ˆæ¯éƒ½æŠ•é€’åˆ°ä¸å…¶ç»‘å®šçš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åæˆ‘ä»¬åœ¨å¤‡ä»½äº¤æ¢æœºä¸‹ç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™æ ·æ‰€æœ‰é‚£äº›åŸäº¤æ¢æœºæ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯ï¼Œå°±ä¼šéƒ½è¿› å…¥è¿™ä¸ªé˜Ÿåˆ—äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å»ºç«‹ä¸€ä¸ªæŠ¥è­¦é˜Ÿåˆ—ï¼Œç”¨ç‹¬ç«‹çš„æ¶ˆè´¹è€…æ¥è¿›è¡Œç›‘æµ‹å’ŒæŠ¥è­¦ã€‚</p>
<h3 id="å®æˆ˜-3"><a class="anchor" href="#å®æˆ˜-3">#</a> å®æˆ˜</h3>
<p>éœ€è¦ä¸€ä¸ªå¤‡ä»½äº¤æ¢æœº  <code>backup.exchange</code> ï¼Œç±»å‹ä¸º  <code>fanout</code> ï¼Œè¯¥äº¤æ¢æœºå‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—  <code>backup.queue</code>  å’Œ  <code>warning.queue</code></p>
<p>ä»£ç ç»“æ„å›¾:</p>
<p><img data-src="https://jsd.cdn.zzko.cn/gh/xustudyxu/image-hosting1@master/20220726/image.109ugczigfdc.webp" alt="image" /></p>
<h3 id="ä¿®æ”¹é«˜çº§ç¡®è®¤å‘å¸ƒ-é…ç½®ç±»"><a class="anchor" href="#ä¿®æ”¹é«˜çº§ç¡®è®¤å‘å¸ƒ-é…ç½®ç±»">#</a> <strong>ä¿®æ”¹é«˜çº§ç¡®è®¤å‘å¸ƒ é…ç½®ç±»</strong></h3>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</pre></td></tr><tr><td data-num="2"></td><td><pre> * descï¼šé…ç½®ç±»ï¼Œå‘å¸ƒç¡®è®¤ (é«˜çº§)</pre></td></tr><tr><td data-num="3"></td><td><pre> */</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfirmConfig</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// äº¤æ¢æœº</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">"confirm_exchange"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">"confirm_queue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">//routingKey</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_ROUTING_KEY</span> <span class="token operator">=</span> <span class="token string">"key1"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// å…³äºå¤‡ä»½çš„</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// äº¤æ¢æœº</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BACKUP_EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">"backup_exchange"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BACKUP_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">"backup_queue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// æŠ¥è­¦é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">WARNING_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">"warning_queue"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// å£°æ˜äº¤æ¢æœºï¼Œè®¾ç½®è¯¥äº¤æ¢æœºçš„å¤‡ä»½äº¤æ¢æœº</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"confirmExchange"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">confirmExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">ExchangeBuilder</span><span class="token punctuation">.</span><span class="token function">directExchange</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_EXCHANGE_NAME</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withArgument</span><span class="token punctuation">(</span><span class="token string">"alternate-exchange"</span><span class="token punctuation">,</span><span class="token constant">BACKUP_EXCHANGE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token comment">// å£°æ˜é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"confirmQueue"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">confirmQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_QUEUE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment">// ç»‘å®š</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">queueBindingExchange</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"confirmQueue"</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> confirmQueue<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                                        <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"confirmExchange"</span><span class="token punctuation">)</span> <span class="token class-name">DirectExchange</span> confirmExchange<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>confirmQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>confirmExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_ROUTING_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment">// å¤‡ä»½äº¤æ¢æœºçš„åˆ›å»º</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"backupExchange"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">FanoutExchange</span> <span class="token function">backupExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FanoutExchange</span><span class="token punctuation">(</span><span class="token constant">BACKUP_EXCHANGE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token comment">// å£°æ˜å¤‡ä»½é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"backupQueue"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">backupQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">BACKUP_QUEUE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token comment">// å£°æ˜æŠ¥è­¦é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"warningQueue"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">warningQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">WARNING_QUEUE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token comment">// ç»‘å®š å¤‡ä»½é˜Ÿåˆ—ç»‘å®šå¤‡ä»½äº¤æ¢æœº</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">backupQueueBindingBackupExchange</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"backupQueue"</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> backupQueue<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                                        <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"backupExchange"</span><span class="token punctuation">)</span> <span class="token class-name">FanoutExchange</span> backupExchange<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>backupQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>backupExchange<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token comment">// ç»‘å®š æŠ¥è­¦é˜Ÿåˆ—ç»‘å®šå¤‡ä»½äº¤æ¢æœº</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token annotation punctuation">@Bean</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">warningQueueBindingBackupExchange</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"warningQueue"</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> warningQueue<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                                                    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"backupExchange"</span><span class="token punctuation">)</span> <span class="token class-name">FanoutExchange</span> backupExchange<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>warningQueue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>backupExchange<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="63"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="æŠ¥è­¦æ¶ˆè´¹è€…"><a class="anchor" href="#æŠ¥è­¦æ¶ˆè´¹è€…">#</a> æŠ¥è­¦æ¶ˆè´¹è€…</h3>
<figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</pre></td></tr><tr><td data-num="2"></td><td><pre> * @author frx</pre></td></tr><tr><td data-num="3"></td><td><pre> * @version 1.0</pre></td></tr><tr><td data-num="4"></td><td><pre> * @date 2022/7/26  22:32</pre></td></tr><tr><td data-num="5"></td><td><pre> * decs: æŠ¥è­¦æ¶ˆè´¹è€…</pre></td></tr><tr><td data-num="6"></td><td><pre>*/</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token annotation punctuation">@Slf4j</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token annotation punctuation">@Component</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WarningConsumer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// æ¥æ”¶æŠ¥è­¦ä¿¡æ¯</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token class-name">ConfirmConfig</span><span class="token punctuation">.</span><span class="token constant">WARNING_QUEUE_NAME</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveWarningMsg</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æŠ¥è­¦å‘ç°ä¸å¯è·¯ç”±æ¶ˆæ¯:&#123;&#125;"</span><span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ç”±äºä¹‹å‰å†™è¿‡  <code>confirm.exchange</code>  äº¤æ¢æœºï¼Œå½“æ›´æ”¹é…ç½®äº†ï¼Œéœ€è¦åˆ æ‰ï¼Œä¸ç„¶ä¼šæŠ¥é”™</p>
<p>æ‰“å¼€æµè§ˆå™¨è®¿é—®åœ°å€ï¼š<span class="exturl" data-url="aHR0cDovL2xvY2FsaG9zdDo4ODg4L2NvbmZpcm0vc2VuZE1lc3NhZ2UvJUU1JUE0JUE3JUU1JUFFJUI2JUU1JUE1JUJEMQ==">http://localhost:8888/confirm/sendMessage/ å¤§å®¶å¥½ 1 (opens new window)</span></p>
<p><img data-src="https://jsd.cdn.zzko.cn/gh/xustudyxu/image-hosting1@master/20220726/image.42foi4mawzq0.webp" alt="image" /></p>
<p>Mandatory å‚æ•°ä¸å¤‡ä»½äº¤æ¢æœºå¯ä»¥ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœä¸¤è€…åŒæ—¶å¼€å¯ï¼Œæ¶ˆæ¯ç©¶ç«Ÿä½•å»ä½•ä»ï¼Ÿè°ä¼˜å…ˆçº§é«˜ï¼Œç»è¿‡ä¸Šé¢ç»“æœæ˜¾ç¤ºç­”æ¡ˆæ˜¯<strong>å¤‡ä»½äº¤æ¢æœºä¼˜å…ˆçº§é«˜</strong>ã€‚</p>
<div class="tags"><a href="/tags/MQ/" rel="tag"><i class="ic i-tag"></i>MQ</a><a href="/tags/release-confirmation/" rel="tag"><i class="ic i-tag"></i>release confirmation</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>æ­¤æ–‡ç« å·²è¢«é˜…è¯»æ¬¡æ•°:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="2023/10/11/RabbitMQ-Release-Confirmation-Advanced/">æ­£åœ¨åŠ è½½...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">æ›´æ–°äº</span><time title="ä¿®æ”¹æ—¶é—´ï¼š2023-10-20 14:35:02" itemprop="dateModified" datetime="2023-10-20T14:35:02+08:00">2023-10-20</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>èµèµ</button><p>è¯·æˆ‘å–[èŒ¶]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/assets/wechatpay.png" alt="é¦–å…ˆæ£® å¾®ä¿¡æ”¯ä»˜"/><p>å¾®ä¿¡æ”¯ä»˜</p></div><div><img data-src="/assets/alipay.png" alt="é¦–å…ˆæ£® æ”¯ä»˜å®"/><p>æ”¯ä»˜å®</p></div></div></div><div id="copyright"><ul><li class="author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>é¦–å…ˆæ£®<i class="ic i-at"><em>@</em></i>ä»¥æ¢¦ä¸ºé©¬</li><li class="link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://shoupeng0.github.io/2023/10/11/RabbitMQ-Release-Confirmation-Advanced/" title="RabbitMQ å‘å¸ƒç¡®è®¤é«˜çº§">https://shoupeng0.github.io/2023/10/11/RabbitMQ-Release-Confirmation-Advanced/</a></li><li class="license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2023/10/11/Relevant-concepts-of-MQ/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;i.imgtg.com&#x2F;2023&#x2F;03&#x2F;09&#x2F;Y0xvg.jpg" title="RabbitMQæ¦‚è¿°åŠå®‰è£…"><span class="type">ä¸Šä¸€ç¯‡</span><span class="category"><i class="ic i-flag"></i>RabbitMQ</span><h3>RabbitMQæ¦‚è¿°åŠå®‰è£…</h3></a></div><div class="item right"><a href="/2023/10/11/Middleware/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;i.imgtg.com&#x2F;2023&#x2F;03&#x2F;09&#x2F;Y0hOs.jpg" title="ä¸­é—´ä»¶ä»‹ç»"><span class="type">ä¸‹ä¸€ç¯‡</span><span class="category"><i class="ic i-flag"></i>RabbitMQ</span><h3>ä¸­é—´ä»¶ä»‹ç»</h3></a></div></div><div class="wrap" id="wcomments"></div><script type="module" data-pjax="data-pjax">import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';

setTimeout(function () {
    init({
        el: '#wcomments',
        serverURL: 'https://waline-test.zeabur.app',
        lang: 'zh-CN',
        locale: {},
        emoji: ["https://unpkg.com/@waline/emojis@1.0.1/weibo","https://unpkg.com/@waline/emojis@1.0.1/alus","https://unpkg.com/@waline/emojis@1.0.1/bilibili","https://unpkg.com/@waline/emojis@1.0.1/qq","https://unpkg.com/@waline/emojis@1.0.1/tieba","https://unpkg.com/@waline/emojis@1.0.1/tw-emoji"],
        meta: ["nick","mail","link"],
        requiredMeta: ["nick","mail"],
        wordLimit: 1000,
        pageSize: 10,
        pageview: true,
        path: window.location.pathname,
        dark: 'html[data-theme="dark"]'
    });
}, 1000)</script></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#rabbitmq-%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4%E9%AB%98%E7%BA%A7"><span class="toc-number">1.</span> <span class="toc-text"> RabbitMQ å‘å¸ƒç¡®è®¤é«˜çº§</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E7%A1%AE%E8%AE%A4springboot%E7%89%88%E6%9C%AC"><span class="toc-number">1.1.</span> <span class="toc-text"> å‘å¸ƒç¡®è®¤ SpringBoot ç‰ˆæœ¬</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text"> ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-number">1.1.2.</span> <span class="toc-text"> å®æˆ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">1.1.3.</span> <span class="toc-text"> æ·»åŠ é…ç½®ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">1.1.4.</span> <span class="toc-text"> æ¶ˆæ¯ç”Ÿäº§è€…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">1.1.5.</span> <span class="toc-text"> æ¶ˆæ¯æ¶ˆè´¹è€…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E5%B8%83%E6%B6%88%E6%81%AF%E5%90%8E%E7%9A%84%E5%9B%9E%E8%B0%83%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.1.6.</span> <span class="toc-text"> æ¶ˆæ¯ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åçš„å›è°ƒæ¥å£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E9%80%80%E6%B6%88%E6%81%AF"><span class="toc-number">1.2.</span> <span class="toc-text"> å›é€€æ¶ˆæ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">1.2.1.</span> <span class="toc-text"> ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98-2"><span class="toc-number">1.2.2.</span> <span class="toc-text"> å®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.2.1.</span> <span class="toc-text"> ä¿®æ”¹é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%9B%9E%E8%B0%83%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.2.2.</span> <span class="toc-text"> ä¿®æ”¹å›è°ƒæ¥å£</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-number">1.3.</span> <span class="toc-text"> å¤‡ä»½äº¤æ¢æœº</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="toc-number">1.3.1.</span> <span class="toc-text"> ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98-3"><span class="toc-number">1.3.2.</span> <span class="toc-text"> å®æˆ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%AB%98%E7%BA%A7%E7%A1%AE%E8%AE%A4%E5%8F%91%E5%B8%83-%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">1.3.3.</span> <span class="toc-text"> ä¿®æ”¹é«˜çº§ç¡®è®¤å‘å¸ƒ é…ç½®ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E8%AD%A6%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">1.3.4.</span> <span class="toc-text"> æŠ¥è­¦æ¶ˆè´¹è€…</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« "><ul><li ><a href="/2023/10/11/Middleware/" rel="bookmark" title="ä¸­é—´ä»¶ä»‹ç»">ä¸­é—´ä»¶ä»‹ç»</a></li><li  class="active"><a href="/2023/10/11/RabbitMQ-Release-Confirmation-Advanced/" rel="bookmark" title="RabbitMQ å‘å¸ƒç¡®è®¤é«˜çº§">RabbitMQ å‘å¸ƒç¡®è®¤é«˜çº§</a></li><li ><a href="/2023/10/11/Relevant-concepts-of-MQ/" rel="bookmark" title="RabbitMQæ¦‚è¿°åŠå®‰è£…">RabbitMQæ¦‚è¿°åŠå®‰è£…</a></li><li ><a href="/2023/10/16/RabbitMQ-Dead-Letter-Queue/" rel="bookmark" title="RabbitMQ æ­»ä¿¡é˜Ÿåˆ—">RabbitMQ æ­»ä¿¡é˜Ÿåˆ—</a></li><li ><a href="/2023/10/16/RabbitMQ-Idempotency-Priority-Inertia/" rel="bookmark" title="RabbitMQ - å¹‚ç­‰æ€§ã€ä¼˜å…ˆçº§ã€æƒ°æ€§">RabbitMQ - å¹‚ç­‰æ€§ã€ä¼˜å…ˆçº§ã€æƒ°æ€§</a></li><li ><a href="/2023/10/18/RabbitMQ-Exchange/" rel="bookmark" title="RabbitMQ äº¤æ¢æœº">RabbitMQ äº¤æ¢æœº</a></li><li ><a href="/2023/10/18/RabbitMQ-Delay-Queue/" rel="bookmark" title="RabbitMQ å»¶è¿Ÿé˜Ÿåˆ—">RabbitMQ å»¶è¿Ÿé˜Ÿåˆ—</a></li><li ><a href="/2023/10/20/Release-Confirmation/" rel="bookmark" title="RabbitMQå‘å¸ƒç¡®è®¤">RabbitMQå‘å¸ƒç¡®è®¤</a></li><li ><a href="/2023/10/20/Unfair-persistence-and-pre-value-distribution-of-entry-level-message-responses/" rel="bookmark" title="RabbitMQçš„ç®€å•ä½¿ç”¨ã€æ¶ˆæ¯åº”ç­”ã€æŒä¹…åŒ–ã€ä¸å…¬å¹³åˆ†å‘å’Œé¢„å–å€¼åˆ†å‘">RabbitMQçš„ç®€å•ä½¿ç”¨ã€æ¶ˆæ¯åº”ç­”ã€æŒä¹…åŒ–ã€ä¸å…¬å¹³åˆ†å‘å’Œé¢„å–å€¼åˆ†å‘</a></li></ul></div><div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="é¦–å…ˆæ£®" data-src="/assets/avatar.jpg"/><p class="name" itemprop="name">é¦–å…ˆæ£®</p><div class="description" itemprop="description">é¦–å…ˆæ£®çš„ä¸ªäººåšå®¢</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">10</span><span class="name">æ–‡ç« </span></a></div><div class="item categories"><a href="/categories/"><span class="count">3</span><span class="name">åˆ†ç±»</span></a></div><div class="item tags"><a href="/tags/"><span class="count">14</span><span class="name">æ ‡ç­¾</span></a></div></nav><div class="social"><a href="https://github.com/shoupeng0" class="item github" rel="noopener" title="https:&#x2F;&#x2F;github.com&#x2F;shoupeng0" target="_blank"><i class="ic i-github"></i></a><a href="https://www.zhihu.com/people/zsssssss-26" class="item zhihu" rel="noopener" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;zsssssss-26" target="_blank"><i class="ic i-zhihu"></i></a><a href="https://music.163.com/#/user/home?id=yourid" class="item music" rel="noopener" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid" target="_blank"><i class="ic i-cloud-music"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-user"></i>å…³äº</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>å…³äºæœ¬ç«™</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>èµèµåšä¸»</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>æ–‡ç« </a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>å½’æ¡£</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>å‹é“¾</a></li><li class="item"><a href="/nav/" rel="section"><i class="ic i-magic"></i>å¯¼èˆª</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2023/10/11/Middleware/" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2023/10/11/Relevant-concepts-of-MQ/" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>éšæœºæ–‡ç« </h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Docker/" title="åˆ†ç±»äºDocker">Docker</a></div><span><a href="/2023/10/08/docker-compose/">Docker Compose å®¹å™¨ç¼–æ’</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MQ/" title="åˆ†ç±»äºMQ">MQ</a><i class="ic i-angle-right"></i><a href="/categories/MQ/RabbitMQ/" title="åˆ†ç±»äºRabbitMQ">RabbitMQ</a></div><span><a href="/2023/10/18/RabbitMQ-Exchange/">RabbitMQ äº¤æ¢æœº</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MQ/" title="åˆ†ç±»äºMQ">MQ</a><i class="ic i-angle-right"></i><a href="/categories/MQ/RabbitMQ/" title="åˆ†ç±»äºRabbitMQ">RabbitMQ</a></div><span><a href="/2023/10/16/RabbitMQ-Dead-Letter-Queue/">RabbitMQ æ­»ä¿¡é˜Ÿåˆ—</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MQ/" title="åˆ†ç±»äºMQ">MQ</a><i class="ic i-angle-right"></i><a href="/categories/MQ/RabbitMQ/" title="åˆ†ç±»äºRabbitMQ">RabbitMQ</a></div><span><a href="/2023/10/16/RabbitMQ-Idempotency-Priority-Inertia/">RabbitMQ - å¹‚ç­‰æ€§ã€ä¼˜å…ˆçº§ã€æƒ°æ€§</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MQ/" title="åˆ†ç±»äºMQ">MQ</a><i class="ic i-angle-right"></i><a href="/categories/MQ/RabbitMQ/" title="åˆ†ç±»äºRabbitMQ">RabbitMQ</a></div><span><a href="/2023/10/11/Relevant-concepts-of-MQ/">RabbitMQæ¦‚è¿°åŠå®‰è£…</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MQ/" title="åˆ†ç±»äºMQ">MQ</a><i class="ic i-angle-right"></i><a href="/categories/MQ/RabbitMQ/" title="åˆ†ç±»äºRabbitMQ">RabbitMQ</a></div><span><a href="/2023/10/11/RabbitMQ-Release-Confirmation-Advanced/">RabbitMQ å‘å¸ƒç¡®è®¤é«˜çº§</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MQ/" title="åˆ†ç±»äºMQ">MQ</a><i class="ic i-angle-right"></i><a href="/categories/MQ/RabbitMQ/" title="åˆ†ç±»äºRabbitMQ">RabbitMQ</a></div><span><a href="/2023/10/18/RabbitMQ-Delay-Queue/">RabbitMQ å»¶è¿Ÿé˜Ÿåˆ—</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MQ/" title="åˆ†ç±»äºMQ">MQ</a><i class="ic i-angle-right"></i><a href="/categories/MQ/RabbitMQ/" title="åˆ†ç±»äºRabbitMQ">RabbitMQ</a></div><span><a href="/2023/10/20/Release-Confirmation/">RabbitMQå‘å¸ƒç¡®è®¤</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MQ/" title="åˆ†ç±»äºMQ">MQ</a><i class="ic i-angle-right"></i><a href="/categories/MQ/RabbitMQ/" title="åˆ†ç±»äºRabbitMQ">RabbitMQ</a></div><span><a href="/2023/10/20/Unfair-persistence-and-pre-value-distribution-of-entry-level-message-responses/">RabbitMQçš„ç®€å•ä½¿ç”¨ã€æ¶ˆæ¯åº”ç­”ã€æŒä¹…åŒ–ã€ä¸å…¬å¹³åˆ†å‘å’Œé¢„å–å€¼åˆ†å‘</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/MQ/" title="åˆ†ç±»äºMQ">MQ</a><i class="ic i-angle-right"></i><a href="/categories/MQ/RabbitMQ/" title="åˆ†ç±»äºRabbitMQ">RabbitMQ</a></div><span><a href="/2023/10/11/Middleware/">ä¸­é—´ä»¶ä»‹ç»</a></span></li></ul></div><div class="rpost pjax"><h2>æœ€æ–°è¯„è®º</h2><ul class="leancloud-recent-comment" id="new-comment"><li class="item" v-for="com in coms"><a v-bind:href="root + com.href" data-pjax-state="data-pjax-state"><span class="breadcrumb">{{com.nick}} @ {{com.time}}</span><span>{{com.text}}<br/></span></a></li></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2023</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">é¦–å…ˆæ£® @ Mr. Shou's blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="ç«™ç‚¹æ€»å­—æ•°">100k å­—</span><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">1:31</span></div><div class="powered-by">åŸºäº <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & Theme.<a href="https://github.com/theme-shoka-x/hexo-theme-shokaX/" rel="noopener" target="_blank">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
        path: `2023/10/11/RabbitMQ-Release-Confirmation-Advanced/`,
        favicon: {
        show: `ä¸è´ŸéŸ¶å`,
        hide: `ä»¥æ¢¦ä¸ºé©¬ï¼`
    },
    search: {
        placeholder: "æ–‡ç« æœç´¢",
        empty: "å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",
        stats: "${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"
    },
    valine: true,
    chart: false,
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">æ–‡ç« æ—¶æ•ˆæ€§æç¤º</span><br>è¿™æ˜¯ä¸€ç¯‡å‘å¸ƒäº {{publish}} å¤©å‰ï¼Œæœ€åä¸€æ¬¡æ›´æ–°åœ¨ {{updated}} å¤©å‰çš„æ–‡ç« ï¼Œéƒ¨åˆ†ä¿¡æ¯å¯èƒ½å·²ç»å‘ç”Ÿæ”¹å˜ï¼Œè¯·æ³¨æ„ç”„åˆ«ã€‚</p></div>`,
    quiz: {
        choice: `å•é€‰é¢˜`,
        multiple: `å¤šé€‰é¢˜`,
        true_false: `åˆ¤æ–­é¢˜`,
        essay: `é—®ç­”é¢˜`,
        gap_fill: `å¡«ç©ºé¢˜`,
        mistake: `é”™é¢˜å¤‡æ³¨`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=default,fetch"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.0.2/pace.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/algoliasearch/4.12.1/algoliasearch-lite.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/instantsearch.js/4.39.0/instantsearch.production.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/quicklink/2.2.0/quicklink.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/??jquery/3.5.1/jquery.min.js,fancybox/3.5.7/jquery.fancybox.min.js,justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" async></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/KaTeX/0.15.2/contrib/copy-tex.min.js" async></script><script src="/js/app.js?v=0.3.6"></script>
    <script type="module" data-pjax>
        let items = []
        import { RecentComments } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs'
        RecentComments({
          serverURL: 'https://waline-test.zeabur.app',
          count: 10,
        }).then(({ comments }) => {
          comments.forEach(function (item) {
              let cText = (item.orig.length > 50) ? item.orig.substring(0,50)+'...' : item.orig
              item.url = item.url !== '/' ?  '/' + item.url : item.url;
              const siteLink = item.url + "#" + item.objectId
              items.push({
                  href: siteLink,
                  nick: item.nick,
                  time: item.insertedAt.split('T').shift(),
                  text: cText
              })
          })
          Vue.createApp({
            data() {
                return {
                    coms: items,
                    root: ''
                }
            }
          }).mount('#new-comment')
        }).catch(function (err) {
          console.error(err)
        })
    </script>
    </body></html>